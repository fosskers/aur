# Maintainer: Colin Woodbury <colingw@gmail.com>
pkgname=aura-git  
pkgver=20130406
pkgrel=1 
pkgdesc="A secure package manager for Arch Linux and the AUR written in Haskell."
url="https://github.com/fosskers/aura"
arch=('i686' 'x86_64')
license=('GPL-3')
depends=('gmp' 'pacman' 'pcre' 'curl')
makedepends=('ghc' 'haskell-regex-base' 'haskell-regex-pcre' 'haskell-curl'
             'haskell-json' 'haskell-mtl' 'haskell-parsec' 'haskell-transformers')
provides=('aura')
conflicts=('aura')
_gitroot='https://github.com/fosskers/aura.git'
_gitname='aura'

build() {
  cd "${srcdir}"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "${srcdir}/$_gitname-build"
  git clone "${srcdir}/$_gitname" "${srcdir}/$_gitname-build"
  cd "${srcdir}/$_gitname-build"

  runhaskell Setup configure --prefix=/usr --docdir=/usr/share/doc/${pkgname} -O
  runhaskell Setup build
}

package() {
  cd "${srcdir}/$_gitname-build"
  runhaskell Setup copy --destdir=${pkgdir}

  # Installing man page
  mkdir -p "$pkgdir/usr/share/man/man8/"
  install -m 644 aura.8 "$pkgdir/usr/share/man/man8/aura.8"
  
  # Installing bash completions
  mkdir -p "$pkgdir/usr/share/bash-completion/completions/"
  install -m 644 completions/bashcompletion.sh "$pkgdir/usr/share/bash-completion/completions/aura"
  
  # Installing zsh completions
  mkdir -p "$pkgdir/usr/share/zsh/site-functions/"
  install -m 644 completions/_aura "$pkgdir/usr/share/zsh/site-functions/_aura"
  
  # Directory for storing PKGBUILDs
  mkdir -p "$pkgdir/var/cache/aura/pkgbuilds"
  
  # Directory for storing installed package states
  mkdir -p "$pkgdir/var/cache/aura/states"
}
